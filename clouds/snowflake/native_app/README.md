## ANALYTICS TOOLBOX CORE

### Introduction

The CARTO Analytics Toolbox for Snowflake is composed of a set of user-defined functions and procedures organized in a set of modules based on the functionality they offer. This app gives you access to the Open Source modules included in the CARTO's Analytics Toolbox, supporting different spatial indexes and other geospatial operations: quadkeys, H3, S2, placekey, geometry constructors, accessors, transformations, etc.

We recommend that at the moment of installing the app you name the app "CARTO". The next guidelines and examples will assume that in order to simplify the onboarding process.

### Installation

#### Grant Usage

This step is required by procedures that have input tables/queries or output tables. The user will have to manually provide permissions to access the tables of a given database. Providing ALL permissions on an SCHEMA ensures that the app can write new tables in that schema.

On the other hand, those tables generated by a procedure belong to the app itself. If the user wants to recover control over those tables (performing SELECT, UPDATE, DELETE...), updating the ownership on those tables is required.

```
-- Set read and write permissions
GRANT USAGE ON DATABASE <database> TO APPLICATION CARTO;
GRANT ALL ON SCHEMA <database>.<schema> TO APPLICATION CARTO;
GRANT SELECT ON TABLE IN SCHEMA <database>.<schema>.<table> TO APPLICATION CARTO;

-- Update ownership (when a table is created within the app)
GRANT OWNERSHIP ON TABLE <database>.<schema>.<output_table> TO ROLE ACCOUNTADMIN;
```

### Usage Examples

Please refer to CARTO's [SQL reference](https://docs.carto.com/data-and-analysis/analytics-toolbox-for-snowflake/sql-reference) to find the full list of available functions and procedures as well as examples.

#### H3_POLYFILL

Returns an array with all the H3 cell indexes **with centers** contained in a given polygon.

```
SELECT carto.H3_POLYFILL(
    TO_GEOGRAPHY('POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))'), 4);
-- 842da29ffffffff
-- 843f725ffffffff
-- 843eac1ffffffff
-- 8453945ffffffff
-- ...
```

Learn how to visualize the result of these queries in CARTO by visiting [https://docs.carto.com/carto-user-manual/maps/data-sources#add-source-from-a-custom-query](https://docs.carto.com/carto-user-manual/maps/data-sources#add-source-from-a-custom-query).

Get a CARTO account in [https://app.carto.com/signup](https://app.carto.com/signup).