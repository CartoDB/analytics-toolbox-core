----------------------------
-- Copyright (C) 2022 CARTO
----------------------------

CREATE OR REPLACE FUNCTION QUADBIN_FROMZXY
(_z INT, _x INT, _y INT)
RETURNS INT
IMMUTABLE
AS $$
BITOR(
    BITOR(
        BITOR(
            BITOR(
                TO_NUMBER('4000000000000000', 'xxxxxxxxxxxxxxxx'),
                BITSHIFTLEFT(1, 59)
            ),
            BITSHIFTLEFT(_z, 52)
        ),
        BITSHIFTRIGHT(
            BITOR(
                BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), 2)), TO_NUMBER('3333333333333333', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), 2)), TO_NUMBER('3333333333333333', 'XXXXXXXXXXXXXXXX')), 1)), TO_NUMBER('5555555555555555', 'XXXXXXXXXXXXXXXX')),
                BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), 2)), TO_NUMBER('3333333333333333', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), TO_NUMBER('0000ffff0000ffff', 'XXXXXXXXXXXXXXXX')), 8)), TO_NUMBER('00ff00ff00ff00ff', 'XXXXXXXXXXXXXXXX')), 4)), TO_NUMBER('0f0f0f0f0f0f0f0f', 'XXXXXXXXXXXXXXXX')), 2)), TO_NUMBER('3333333333333333', 'XXXXXXXXXXXXXXXX')), 1)), TO_NUMBER('5555555555555555', 'XXXXXXXXXXXXXXXX')), 1)
            ),
            12
        )
    ),
    BITSHIFTLEFT(
        1,
        52 - BITSHIFTLEFT(_z, 1)
    ) - 1
)
$$;