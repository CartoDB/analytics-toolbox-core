----------------------------
-- Copyright (C) 2022 CARTO
----------------------------

CREATE OR REPLACE FUNCTION QUADBIN_FROMZXY
(_z INT, _x INT, _y INT)
RETURNS INT
IMMUTABLE
AS $$
    BITOR(
        BITOR(
            BITOR(
                BITOR(
                    TO_NUMBER('4000000000000000', 'xxxxxxxxxxxxxxxx'),
                    BITSHIFTLEFT(1, 59)
                ),
                BITSHIFTLEFT(_z, 52)
            ),
            BITSHIFTRIGHT(
                BITOR(
                    BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), 2)), 3689348814741910323), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , BITSHIFTLEFT(BITSHIFTLEFT(cast(_x AS int), (32-_z)) , 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), 2)), 3689348814741910323), 1)), 6148914691236517205),
                    BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), 2)), 3689348814741910323), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), BITSHIFTLEFT(BITAND(BITOR(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), BITSHIFTLEFT(BITAND(BITOR(BITSHIFTLEFT(cast(_y AS int), (32-_z)), BITSHIFTLEFT(BITSHIFTLEFT(cast(_y AS int), (32-_z)), 16)), 281470681808895), 8)), 71777214294589695), 4)), 1085102592571150095), 2)), 3689348814741910323), 1)), 6148914691236517205), 1)
                ),
                12
            )
        ),
        BITSHIFTLEFT(
            1,
            52 - BITSHIFTLEFT(_z, 1)
        ) - 1
    )
$$;